}
get_et_score <- function(text){
text1 <- str_remove_all(text, pattern = "[a-z]")
text2 <- str_split(text1, pattern = " ")
ht_r <- get_score(text2[[1]][2])
ft_r <- get_score(text2[[1]][3])
et_r <- get_score(text2[[1]][1])
ht_goals <- get_ha_goals(ht_r)
ft_goals <- get_ha_goals(ft_r)
et_goals <- get_ha_goals(et_r)
et_goals$HG <- et_goals$HG - ft_goals$HG
et_goals$AG <- et_goals$AG - ft_goals$AG
a <- data.frame(FTHG = ft_goals$HG, FTAG = ft_goals$AG , HTHG = ht_goals$HG, HTAG = ht_goals$AG,
ETHG = et_goals$HG, ETAG = et_goals$HG, PTHG = NA, PTAG = NA)
return(a)
}
get_penalties_score <- function(text){
text1 <- str_remove_all(text, pattern = "[a-z]")
text2 <- str_split(text1, pattern = " ")
ht_r <- get_score(text2[[1]][2])
ft_r <- get_score(text2[[1]][3])
et_r <- get_score(text2[[1]][4])
pn_r <- get_score(text2[[1]][1])
ht_goals <- get_ha_goals(ht_r)
ft_goals <- get_ha_goals(ft_r)
et_goals <- get_ha_goals(et_r)
pn_goals <- get_ha_goals(pn_r)
et_goals$HG <- et_goals$HG - ft_goals$HG
et_goals$AG <- et_goals$AG - ft_goals$AG
a <- data.frame(FTHG = ft_goals$HG, FTAG = ft_goals$AG , HTHG = ht_goals$HG, HTAG = ht_goals$AG,
ETHG = et_goals$HG, ETAG = et_goals$HG, PTHG = pn_goals$HG, PTAG = pn_goals$AG)
return(a)
}
get_away_goal_games <- function(data = games) {
result <- c()
rows <- seq(from = 1, to = nrow(data), by = 2)
for(i in rows){
f_leg <- data[i,]
s_leg <- data[i+1,]
if(f_leg$FTHG + s_leg$FTAG == f_leg$FTAG + s_leg$FTHG){
result <- rbind(result, f_leg, s_leg)
}
}
return(result)
}
get_correct_goals <- function(score) {
numbers <- str_remove_all(score, pattern = "[a-z]")
scores <- str_split(numbers, pattern = " ")
len <- length(scores[[1]])
result <- c()
if(len == 5){
result <- get_penalties_score(scores)
}
else if(len == 4){
result <- get_et_score(scores)
}
else{
result <- get_scores_for_halfs(scores)
}
return(result)
}
get_right_date <- function(leg, date){
leg_string <- paste(leg,": ",sep = "")
date_nl <- sub(x = date, pattern = leg_string, replacement = "", fixed = T )
real_date <- str_split(date_nl , pattern = " ")[[1]][1]
return(as.Date(real_date, format = "%d/%m/%Y"))
}
clean_scores <- function(data){
return(data %>%
rowwise() %>%
mutate(FTHG = get_correct_goals(RESULT)$FTHG,
FTAG = get_correct_goals(RESULT)$FTAG,
HTHG = get_correct_goals(RESULT)$HTHG,
HTAG = get_correct_goals(RESULT)$HTAG,
ETHG = get_correct_goals(RESULT)$ETHG,
ETAG = get_correct_goals(RESULT)$ETAG,
PTHG = get_correct_goals(RESULT)$PTHG,
PTAG = get_correct_goals(RESULT)$PTAG) %>%
select(COMP, SEASON, ROUND, LEG, DATE, HOMETEAM, AWAYTEAM,
FTHG, FTAG, HTHG, HTAG, ETHG, ETAG, PTHG, PTAG))
}
get_no_et_games <- function(data = et_games){
first_rounds <- get_first_games(data = et_games)
et_games_1 <- rbind(data, first_rounds)
games <- ucl_po_94_18 %>%
anti_join(et_games_1)
games <- clean_scores(games)
games <- games %>%
mutate(DATE = get_right_date(LEG, DATE))
games$LEG <- factor(games$LEG, levels = unique(games$LEG), labels = c("1", "2", "F"))
final_games <- games %>%
filter(LEG == "F")
games <- games %>%
anti_join(final_games)
return(games)
}
get_et_games <- function(data = ucl_po_94_18) {
et_games <- data %>%
filter(str_detect(RESULT, pattern = "[a-zA-Z]"))
et_games <- et_games %>%
filter(!(SEASON == "2004-2005" & AWAYTEAM == "AC Milan"
& HOMETEAM == "Inter" & ROUND == "viertelfinale"))
et_games <- clean_scores(et_games)
return(et_games)
}
get_et_def <- function(data = ucl_po_94_18){
et_games <- data %>%
filter(str_detect(RESULT, pattern = "[a-zA-Z]"))
et_games <- et_games %>%
filter(!(SEASON == "2004-2005" & AWAYTEAM == "AC Milan"
& HOMETEAM == "Inter" & ROUND == "viertelfinale"))
return(et_games)
}
et_games <- get_et_games(data = ucl_po_94_18)
et_fr <- get_first_games(data = et_games, source = ucl_po_94_18)
et_fr <- clean_scores(et_fr)
et_fr <- et_fr %>%
mutate(DATE = get_right_date(LEG, DATE))
et_fr$LEG <- factor(et_fr$LEG, levels = unique(et_fr$LEG), labels = c("1"))
et_def <- get_et_def()
games <- get_no_et_games(data = et_def)
aways <- get_away_goal_games(data = games)
et_games <- et_games %>%
mutate(DATE = get_right_date(LEG, DATE))
et_games$LEG <- factor(et_games$LEG, levels = unique(et_games$LEG), labels = c("2", "F"))
et_no_finals <- et_games %>%
filter(LEG != "F")
View(et_no_finals)
View(et_no_finals)
identical(et_no_finals$HOMETEAM, et_fr$AWAYTEAM)
View(aways)
View(aways)
combine_legs <- function(f_leg, s_leg, st_id){
result <- c()
for(i in 1:nrow(f_leg)){
f_game <- f_leg[i,]
s_game <- s_leg[i,]
f_game$LEG_ID <- st_id
s_game$LEG_ID <- st_id
print(f_game)
result <- rbind(result, f_game, s_game)
}
return(result)
}
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_legs)
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals)
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1)
View(et_legs)
View(et_legs)
combine_legs <- function(f_leg, s_leg, st_id){
result <- c()
for(i in 1:nrow(f_leg)){
f_game <- f_leg[i,]
s_game <- s_leg[i,]
f_game$LEG_ID <- st_id
s_game$LEG_ID <- st_id
print(f_game)
result <- rbind(result, f_game, s_game)
st_id <- st_id + 1
}
return(result)
}
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1)
View(et_legs)
View(et_legs)
View(games)
View(games)
combine_legs <- function(f_leg, s_leg, st_id){
result <- c()
for(i in 1:nrow(f_leg)){
f_game <- f_leg[i,]
s_game <- s_leg[i,]
f_game$LEG_ID <- st_id
s_game$LEG_ID <- st_id
result <- rbind(result, f_game, s_game)
st_id <- st_id + 1
}
return(result)
}
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1)
#agr = away goal rule
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1)
agr_legs <- combine_legs(f_leg = f_leg, e_leg)
f_leg <- aways %>%
filter(LEG == "1")
s_leg <- aways %>%
filter(LEG == "2")
agr_legs <- combine_legs(f_leg = f_leg, e_leg)
dim(et_legs)
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = dim[et_legs][1])
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = dim(et_legs)[1])
View(agr_legs)
View(agr_legs)
View(aways)
View(aways)
agr_legs[-1,]
tail(agr_legs)
last_id <- tail(agr_legs, 1)
last_id
last_id <- tail(agr_legs, 1)$LEG_ID + 1
last_id
et_finals <- et_games %>%
filter(LEG == "F" )
View(et_finals)
View(et_finals)
View(agr_legs)
View(agr_legs)
View(et_legs)
View(et_legs)
#agr = away goal rule
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1)
last_id <- tail(et_legs, 1)$LEG_ID + 1
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = last_id)
last_id_1 <- tail(agr_legs, 1)$LEG_ID + 1
finals_leg_ids <- function(final_games, st_id){
result <- c()
for(i in 1:nrow(final_games)){
game <- final_games[i,]
game$LEG_ID <- st_id
result <- rbind(result, game)
}
return(result)
}
last_id_1 <- tail(agr_legs, 1)$LEG_ID + 1
#agr = away goal rule
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1)
last_id <- tail(et_legs, 1)$LEG_ID + 1
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = last_id)
last_id_1 <- tail(agr_legs, 1)$LEG_ID + 1
last_id_1
finals_leg_ids <- function(final_games, st_id){
result <- c()
for(i in 1:nrow(final_games)){
game <- final_games[i,]
game$LEG_ID <- st_id
result <- rbind(result, game)
}
return(result)
}
final_legs <- finals_leg_ids(final_games = et_finals, st_id = last_id_1)
View(final_legs)
View(final_legs)
View(aways)
View(agr_legs)
View(agr_legs)
et_agr <- rbind(et_legs, agr_legs, final_legs)
View(et_agr)
View(et_agr)
et_agr <- rbind(et_legs, agr_legs, final_legs)
save(et_agr, file = "data/et_agr_94_18.rda")
load("/home/narek/Desktop/ET_Analysis/data/et_agr_94_18.rda")
View(et_agr)
source('~/Desktop/ET_Analysis/cleanData.R', echo=TRUE)
View(et_agr)
View(et_agr)
write.csv(et_agr, file = "data/et_agr_94_18.csv")
combine_legs <- function(f_leg, s_leg, st_id, type){
result <- c()
for(i in 1:nrow(f_leg)){
f_game <- f_leg[i,]
s_game <- s_leg[i,]
f_game$LEG_ID <- st_id
s_game$LEG_ID <- st_id
f_game$TYPE <- type
s_game$TYPE <- type
result <- rbind(result, f_game, s_game)
st_id <- st_id + 1
}
return(result)
}
combine_legs <- function(f_leg, s_leg, st_id, type){
result <- c()
for(i in 1:nrow(f_leg)){
f_game <- f_leg[i,]
s_game <- s_leg[i,]
f_game$LEG_ID <- st_id
s_game$LEG_ID <- st_id
f_game$TYPE <- type
s_game$TYPE <- type
result <- rbind(result, f_game, s_game)
st_id <- st_id + 1
}
return(result)
}
finals_leg_ids <- function(final_games, st_id){
result <- c()
for(i in 1:nrow(final_games)){
game <- final_games[i,]
game$LEG_ID <- st_id
game$TYPE <- "F"
result <- rbind(result, game)
}
return(result)
}
source('~/Desktop/ET_Analysis/cleanData.R', echo=TRUE)
#agr = away goal rule
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1 , type = "ET")
last_id <- tail(et_legs, 1)$LEG_ID + 1
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = last_id, type = "AGR")
last_id_1 <- tail(agr_legs, 1)$LEG_ID + 1
final_legs <- finals_leg_ids(final_games = et_finals, st_id = last_id_1)
et_agr <- rbind(et_legs, agr_legs, final_legs)
View(et_agr)
View(et_agr)
as.factor(et_agr$TYPE)
et_agr$TYPE <- factor(et_agr$TYPE, levels = unique(etr_agr$TYPE), labels = c("ET","AGR","F"))
et_agr$TYPE <- factor(et_agr$TYPE, levels = unique(et_agr$TYPE), labels = c("ET","AGR","F"))
as.factor(et_agr$TYPE)
str(et_agr)
View(et_agr)
View(et_agr)
save(et_agr, file = "data/et_agr_94_18.rda")
write.csv(et_agr, file = "data/et_agr_94_18.csv")
source('~/Desktop/ET_Analysis/cleanData.R', echo=TRUE)
View(games)
View(games)
View(games)
View(games)
save(games, file = "data/no_et_games.rda")
write.csv(games, file = "data/no_et_games.csv")
View(et_games)
View(et_games)
View(et_agr)
View(et_agr)
View(et_games)
View(et_games)
#agr = away goal rule
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1 , type = "ET")
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = 1, type = "AGR")
final_legs <- finals_leg_ids(final_games = et_finals, st_id = 1)
et_agr <- rbind(et_legs, agr_legs, final_legs)
View(et_agr)
View(et_agr)
combine_legs <- function(f_leg, s_leg, st_id, type){
result <- c()
for(i in 1:nrow(f_leg)){
f_game <- f_leg[i,]
s_game <- s_leg[i,]
leg_id <- paste(type, st_id, sep = "")
f_game$LEG_ID <- leg_id
s_game$LEG_ID <- leg_id
f_game$TYPE <- type
s_game$TYPE <- type
result <- rbind(result, f_game, s_game)
st_id <- st_id + 1
}
return(result)
}
#agr = away goal rule
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1 , type = "ET")
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = 1, type = "AGR")
final_legs <- finals_leg_ids(final_games = et_finals, st_id = 1)
View(et_legs)
View(et_legs)
final_legs <- finals_leg_ids(final_games = et_finals, st_id = 1)
View(final_legs)
View(final_legs)
source('~/workspace/SportsAnalytics/ET_Analysis/cleanData.R', echo=TRUE)
source('~/workspace/SportsAnalytics/ET_Analysis/cleanData.R', echo=TRUE)
View(final_legs)
View(final_legs)
View(games)
View(games)
View(et_agr)
View(et_agr)
et_agr <- et_agr %>%
filter(LEG_ID != "ET6")
et_agr <- et_agr %>%
filter(LEG_ID != "ET6")
save(et_agr, file = "data/et_agr_94_18.rda")
write.csv(et_agr, file = "data/et_agr_94_18.csv")
save(games, file = "data/no_et_games.rda")
write.csv(games, file = "data/no_et_games.csv")
packages_list <- c("ggplot2", "dplyr", "stringr")
install_or_call <- function(list = packages_list){
installed <- installed.packages()[,"Package"]
for( package in packages_list ){
if(!(package %in% installed)){
install.packages(package)
}
do.call(library, list(package))
}
}
install_or_call()
load("data/ucl_po_1994_2018.rda")
View(et_agr)
View(et_agr)
View(games)
View(games)
View(games)
View(games)
et_agr <- et_agr %>%
unique(everything())
packages_list <- c("ggplot2", "dplyr", "stringr")
install_or_call <- function(list = packages_list){
installed <- installed.packages()[,"Package"]
for( package in packages_list ){
if(!(package %in% installed)){
install.packages(package)
}
do.call(library, list(package))
}
}
install_or_call()
load("data/ucl_po_1994_2018.rda")
et_agr <- et_agr %>%
unique(everything())
et_agr <- et_agr %>%
distinct(everything())
et_agr <- et_agr %>%
distinct(.keep_all = T)
et_agr <- et_agr %>%
distinct(.keep_all = T)
unique(et_agr[,-c(7)])
length(unique(et_agr[,-c(7)]))
length(unique(et_agr[,]))
save(et_agr, file = "data/et_agr_94_18.rda")
View(et_agr)
View(et_agr)
nrow(unique(et_agr[,]))
View(et_agr)
View(et_agr)
length(unique(et_agr$DATE))
length(unique(games$DATE))
View(games)
View(games)
install.packages("hablar")
packages_list <- c("ggplot2", "dplyr", "stringr","hablar")
install_or_call <- function(list = packages_list){
installed <- installed.packages()[,"Package"]
for( package in packages_list ){
if(!(package %in% installed)){
install.packages(package)
}
do.call(library, list(package))
}
}
et_agr[,-c("LEG_ID")]
et_agr[,-c(16)]
et_agr[,-c(16)] %>%
find_duplicates()
packages_list <- c("ggplot2", "dplyr", "stringr","hablar")
install_or_call <- function(list = packages_list){
installed <- installed.packages()[,"Package"]
for( package in packages_list ){
if(!(package %in% installed)){
install.packages(package)
}
do.call(library, list(package))
}
}
install_or_call()
et_agr[,-c(16)] %>%
find_duplicates()
a <- et_agr[,-c(16)] %>%
find_duplicates()
View(a)
View(a)
games <- games[,-c(16)] %>%
find_duplicates()
games <- combine_legs(f_leg = games_1, s_leg = games_2, st_id = 1, type = "G")
a <- et_agr[,-c(16)] %>%
find_duplicates()
a <- et_agr %>%
find_duplicates()
View(a)
View(a)
a <- et_agr[,-c(16)] %>%
find_duplicates()
View(a)
View(a)
View(final_legs)
View(final_legs)
final_legs %>% find_duplicates()
View(et_finals)
View(et_finals)
View(et_games)
View(et_games)
dist <- distinct(et_agr)
dist <- et_agr %>%
distinct(SEASON, ROUND, HOMETEAM, AWAYTEAM, DATE)
final_legs <- final_legs %>%
distinct(SEASON, ROUND, HOMETEAM, AWAYTEAM, DATE)
source('~/workspace/SportsAnalytics/ET_Analysis/cleanData.R', echo=TRUE)
final_legs <- final_legs %>%
distinct(SEASON, ROUND, HOMETEAM, AWAYTEAM, DATE, .keep_all = T)
final_legs <- finals_leg_ids(final_games = et_finals, st_id = 1)
final_legs <- final_legs %>%
distinct(SEASON, ROUND, HOMETEAM, AWAYTEAM, DATE, .keep_all = T)
games_1 <- games %>%
filter(LEG == 1)
games_2 <- games %>%
filter(LEG == 2)
games <- combine_legs(f_leg = games_1, s_leg = games_2, st_id = 1, type = "G")
et_agr <- rbind(et_legs, agr_legs, final_legs)
View(et_agr)
View(et_agr)
et_finals <- et_finals %>%
distinct(SEASON, ROUND, HOMETEAM, AWAYTEAM, DATE, .keep_all = T)
#agr = away goal rule
et_legs <- combine_legs(f_leg = et_fr, s_leg = et_no_finals,1 , type = "ET")
agr_legs <- combine_legs(f_leg = f_leg, s_leg = s_leg, st_id = 1, type = "AGR")
final_legs <- finals_leg_ids(final_games = et_finals, st_id = 1)
games <- combine_legs(f_leg = games_1, s_leg = games_2, st_id = 1, type = "G")
et_agr <- rbind(et_legs, agr_legs, final_legs)
et_agr$TYPE <- factor(et_agr$TYPE, levels = unique(et_agr$TYPE), labels = c("ET","AGR","F"))
str(et_agr)
dist_games <- games %>%
distinct(SEASON, ROUND, HOMETEAM, AWAYTEAM, DATE, .keep_all = T)
dist_et_agr <- et_agr %>%
distinct(SEASON, ROUND, HOMETEAM, AWAYTEAM, DATE, .keep_all = T)
source('~/workspace/SportsAnalytics/ET_Analysis/cleanData.R', echo=TRUE)
