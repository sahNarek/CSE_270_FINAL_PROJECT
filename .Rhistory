D = as_ht$D + as_at$D, L = as_ht$L + as_at$L, FTGF = as_ht$FTGF + as_at$FTGF,
FTGA = as_ht$FTGA + as_at$FTGA, ETGF = as_ht$ETGF + as_at$ETGF,
ETGA = as_ht$ETGA + as_at$ETGA)
table$M <- table$W + table$D + table$L
table$POINTS <- 3 * table$W + table$D
table$EGM <- sapply(table$TEAM, games_in_et, data = et_agr)
return(table %>%
select(TEAM, M, POINTS ,everything()) %>%
arrange(desc(POINTS)))
}
tables <- standings(data = all_games)
cl_po_teams <- tables$TEAM
elo_teams <- unique(elo_ratings$team)
all.equal("Paris Saint-Germain", "PSG")
packages_list <- c("ggplot2","dplyr", "scales", "stringdist",
"ggmap", "plotly", "SportsAnalytics270")
install_or_call <- function(list = packages_list){
installed <- installed.packages()[,"Package"]
for( package in packages_list ){
if(!(package %in% installed)){
install.packages(package)
}
do.call(library, list(package))
}
}
install_or_call()
amatch("Paris Saint-Germain",c("PSG"), maxDist = 3)
amatch("Paris Saint-Germain",c("PSG"), maxDist = 2)
amatch("PSG",c("Paris Saint-Germain"), maxDist = 2)
amatch("PSG", cl_po_teams)
amatch("psg", cl_po_teams)
amatch("Paris", cl_po_teams)
amatch("Paris", cl_po_teams, maxDist = 5)
cl_po_teams[15]
cl_po_teams[15,]
cl_po_teams
amatch("Paris", cl_po_teams, maxDist = 5)
elo_ratings_1 <- elo_ratings %>%
filter(team %in% cl_po_teams)
length(unique(elo_ratings_1))
length(unique(elo_ratings_1$team))
View(elo_ratings_1)
View(elo_ratings_1)
cl_po_teams %>%
anti_join(elo_ratings_1$team)
as.data.frame(cl_po_teams) %>%
anti_join(elo_ratings_1$team)
as.data.frame(cl_po_teams) %>%
anti_join(as.data.frame(elo_ratings_1$team))
as.data.frame(cl_po_teams)
cl_teams <- as.data.frame(cl_po_teams)
el_teams <- as.data.frame(elo_ratings_1$team)
el_teams
View(el_teams)
View(el_teams)
colnames(cl_teams) <- "TEAM"
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
View(cl_teams)
View(cl_teams)
results <- c()
similar <- common_chars("FC Barcelona", team)
results <- c()
for(team in el_teams$TEAM){
similar <- common_chars("FC Barcelona", team)
result$value <- similar
result$team <- team
results <- rbind(results, result)
}
results <- c()
for(team in el_teams$TEAM){
result <- c()
similar <- common_chars("FC Barcelona", team)
result$value <- similar
result$team <- team
results <- rbind(results, result)
}
View(results)
View(results)
results <- as.data.frame(results)
View(results)
View(results)
el_teams
cl_teams <- as.data.frame(cl_po_teams)
el_teams <- as.data.frame(unique(elo_ratings_1$team))
colnames(cl_teams) <- "TEAM"
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
results <- c()
for(team in el_teams$TEAM){
result <- c()
similar <- common_chars("FC Barcelona", team)
result$value <- similar
result$team <- team
results <- rbind(results, result)
}
View(results)
View(results)
View(results)
View(results)
results <- as.data.frame(results)
View(results)
View(results)
results <- c()
for(team in unique(elo_ratings$team)){
result <- c()
similar <- common_chars("FC Barcelona", team)
result$value <- similar
result$team <- team
results <- rbind(results, result)
}
results <- as.data.frame(results)
View(results)
View(results)
results <- c()
for(team in unique(elo_ratings$team)){
result <- c()
print(team)
similar <- common_chars("FC Barcelona", team)
result$value <- similar
result$team <- team
results <- rbind(results, result)
}
common_chars("FC Barcelona", "UFA")
x <- "FC Barcelona"
y <- "UFA"
length(unique(as.vector(unlist(strsplit(x,"")),mode="list")))
length(unique(as.vector(unlist(strsplit(y,"")),mode="list")))
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
results <- as.data.frame(results)
View(results)
View(results)
View(results)
View(results)
str(results)
results <- as.data.frame(results)
str(results)
View(results)
View(results)
results %>%
filter(value = max(value))
results %>%
filter(value == max(value))
results$value <- as.numeric(results$value)
results$team <- as.character(results$team)
results$value <- as.numeric(results$value)
results$team <- as.character(results$team)
results <- as.data.frame(results)
results %>%
filter(value == max(value))
cl_teams <- as.data.frame(cl_po_teams)
el_teams <- as.data.frame(unique(elo_ratings_1$team))
colnames(cl_teams) <- "TEAM"
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
View(cl_teams)
View(cl_teams)
View(elo_ratings)
View(elo_ratings)
elo_ratings_1 <- elo_ratings %>%
filter(team %in% cl_po_teams)
str_remove_all("FC Barcelona", "FC", fixed = T)
packages_list <- c("ggplot2","dplyr", "scales", "stringdist",
"ggmap", "plotly", "SportsAnalytics270", "stringr")
install_or_call()
str_remove_all("FC Barcelona", "FC", fixed = T)
str_remove_all("FC Barcelona", "FC")
trimws(str_remove_all("FC Barcelona", "FC"))
sapply(cl_teams$TEAM, str_remove_all, pattern = "FC")
res1 <- sapply(cl_teams$TEAM, str_remove_all, pattern = "FC")
trimws(res1)
res1 <- sapply(cl_teams$TEAM, str_remove_all, pattern = "FC")
res1 <- trimws(res1)
res1 <- sapply(cl_teams$TEAM, str_remove_all, pattern = "CF")
res1 <- trimws(res1)
res1 <- sapply(cl_teams$TEAM, str_remove_all, pattern = "AC")
res1 <- trimws(res1)
res1
res1 <- sapply(cl_teams$TEAM, str_remove_all, pattern = "FC")
res1 <- trimws(res1)
res1
res1 <- sapply(res1, str_remove_all, pattern = "CF")
res1 <- trimws(res1)
res1 <- sapply(res1, str_remove_all, pattern = "AC")
res1 <- trimws(res1)
res1
res1 <- sapply(cl_teams$TEAM, str_remove_all, pattern = "FC")
res1 <- trimws(res1)
res1 <- sapply(res1, str_remove_all, pattern = "CF")
res1 <- trimws(res1)
res1 <- sapply(res1, str_remove_all, pattern = "AC")
res1 <- trimws(res1)
res1
cl_teams$TEAM <- res1
elo_ratings_2 <- elo_ratings %>%
filter(team %in% cl_teams$TEAM)
length(unique(elo_ratings_2))
length(unique(elo_ratings_2$team))
el_teams <- as.data.frame(unique(elo_ratings_1$team))
cl_teams <- cl_teams %>%
anti_join(el_teams)
View(el_teams)
View(el_teams)
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
colnames(el_teams) <- "TEAM"
el_teams <- as.data.frame(unique(elo_ratings_2$team))
View(el_teams)
View(el_teams)
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
View(cl_teams)
View(cl_teams)
res1 <- sapply(res1, str_remove_all, pattern = "SL")
res1 <- trimws(res1)
cl_teams$TEAM <- res1
cl_po_teams <- tables$TEAM
elo_ratings_1 <- elo_ratings %>%
filter(team %in% cl_po_teams)
cl_teams <- as.data.frame(cl_po_teams)
el_teams <- as.data.frame(unique(elo_ratings_1$team))
colnames(cl_teams) <- "TEAM"
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
cl_teams$TEAM <- res1
elo_ratings_2 <- elo_ratings %>%
filter(team %in% cl_teams$TEAM)
el_teams <- as.data.frame(unique(elo_ratings_2$team))
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
res1 <- sapply(cl_teams$TEAM, str_remove_all, pattern = c("FC"))
res2 <- sapply(cl_teams$TEAM, str_remove_all, pattern = c("FC","CF","AC","SL"))
res2
res2 <- trimws(res2)
res2
cl_po_teams <- tables$TEAM
elo_ratings_1 <- elo_ratings %>%
filter(team %in% cl_po_teams)
cl_teams <- as.data.frame(cl_po_teams)
el_teams <- as.data.frame(unique(elo_ratings_1$team))
colnames(cl_teams) <- "TEAM"
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
res2 <- sapply(cl_teams$TEAM, str_remove_all, pattern = c("FC","CF","AC","SL"))
res2 <- trimws(res2)
res2
res2 <- lapply(cl_teams$TEAM, str_remove_all, pattern = c("FC","CF","AC","SL"))
res2 <- trimws(res2)
res2
res2 <- apply(cl_teams$TEAM, str_remove_all, pattern = c("FC","CF","AC","SL"))
res2 <- sapply(cl_teams$TEAM, str_remove_all, pattern = c("FC","CF","AC","SL"))
res2 <- trimws(res2)
cl_teams$TEAM <- res2
res2 <- sapply(cl_teams$TEAM, str_remove_all, pattern = c("FC","CF","AC","SL"))
res2 <- trimws(res2)
View(res2)
View(res2)
cl_teams <- cl_teams %>%
anti_join(el_teams)
View(cl_teams)
View(cl_teams)
pattern = "^FC$|^CF$"
pattern = "^FC$|^CF$"
string <- "FCaaaCF"
str_remove_all(string, pattern = pattern)
pattern = "[^FC$|^CF$]"
string <- "FCaaaCF"
str_remove_all(string, pattern = pattern)
string <- "FC aaa CF"
str_remove_all(string, pattern = pattern)
string <- "FC aaa CF"
pattern = "[^FC$|^CF$]"
str_remove_all(string, pattern = pattern)
pattern = "[^FC$ | ^CF$]"
pattern = "[^FC$]"
string <- "FC aaa CF"
str_remove_all(string, pattern = pattern)
str_extract_all(string, pattern = pattern)
str_extract(string, pattern = pattern)
str_remove_all(string, pattern = pattern)
string <- "FCaaaCF"
str_extract_all(string, pattern = pattern)
str_extract(string, pattern = pattern)
str_extract_all(string, pattern = pattern)
pattern = "[^FC$ | ^CF$]"
string <- "FC aaa CF"
paste(str_extract_all(string, pattern = pattern))
paste0(unlist(str_extract_all(string, pattern = pattern)))
pattern = "FC | CF"
string <- "FC aaa CF"
str_extract_all(string, pattern = pattern)
str_remove_all(string, pattern = pattern)
string <- "FCaaaCF"
str_remove_all(string, pattern = pattern)
pattern = "AFC | FC | CF | SSC | AJ | KAA | VfL | SL"
teams <- sapply(cl_teams$TEAM, str_remove_all, pattern = pattern)
teams
pattern = "FC | CF | SSC | AJ | KAA | VfL | SL"
str_remove_all(string, pattern = pattern)
teams <- sapply(cl_teams$TEAM, str_remove_all, pattern = pattern)
teams
pattern = "AFC|FC|CF|SSC|AJ|KAA|VfL|SL"
str_remove_all(string, pattern = pattern)
teams <- sapply(cl_teams$TEAM, str_remove_all, pattern = pattern)
teams
pattern = "AFC|FC|CF|SSC|AJ|KAA|VfL|SL|AC"
str_remove_all(string, pattern = pattern)
teams <- sapply(cl_teams$TEAM, str_remove_all, pattern = pattern)
pattern = "AFC|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS"
str_remove_all(string, pattern = pattern)
teams <- sapply(cl_teams$TEAM, str_remove_all, pattern = pattern)
teams <- trimws(sapply(cl_teams$TEAM, str_remove_all, pattern = pattern))
teams
View(tables)
View(tables)
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS"
str_remove_all(string, pattern = pattern)
teams <- trimws(sapply(cl_teams$TEAM, str_remove_all, pattern = pattern))
teams
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|0-9"
str_remove_all(string, pattern = pattern)
teams <- trimws(sapply(cl_teams$TEAM, str_remove_all, pattern = pattern))
teams
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS"
str_remove_all(string, pattern = pattern)
teams <- trimws(sapply(teams, str_remove_all, pattern = "[0-9]"))
teams
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]"
teams <- trimws(sapply(cl_teams$TEAM, str_remove_all, pattern = pattern))
teams
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]|\\."
str_remove_all(string, pattern = pattern)
teams <- trimws(sapply(cl_teams$TEAM, str_remove_all, pattern = pattern))
teams
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]|\\."
teams <- trimws(sapply(cl_teams$TEAM, str_remove_all, pattern = pattern))
teams
cleaning_elos <- function(data,subset){
elo_ratings <- data %>%
filter(team %in% subset)
cl_teams <- as.data.frame(subset)
el_teams <- as.data.frame(unique(data$team))
colnames(cl_teams) <- "TEAM"
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
return(list(elos = elo_ratings,
misssing_teams = cl_teams))
}
abc <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)
abc <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$elos
elo_ratings_1 <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$elos
missing_teams <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$missing_teams
cleaning_elos <- function(data,subset){
elo_ratings <- data %>%
filter(team %in% subset)
cl_teams <- as.data.frame(subset)
el_teams <- as.data.frame(unique(data$team))
colnames(cl_teams) <- "TEAM"
colnames(el_teams) <- "TEAM"
cl_teams <- cl_teams %>%
anti_join(el_teams)
return(list(elos = elo_ratings,
missing_teams = cl_teams))
}
cl_po_teams <- tables$TEAM
elo_ratings_1 <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$elos
missing_teams <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$missing_teams
View(missing_teams)
View(missing_teams)
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]|\\."
teams <- trimws(sapply(missing_teams$TEAM, str_remove_all, pattern = pattern))
teams
missing_teams$TEAM <- teams
elo_ratings_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams)$elos
elo_ratings_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$TEAM)$elos
missing_teams_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$TEAM)$missing_teams
View(missing_teams_2)
View(missing_teams_2)
elo_ratings_1 <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$elos
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
packages_list <- c("ggplot2","dplyr", "scales", "stringdist", "magrittr",
"ggmap", "plotly", "SportsAnalytics270", "stringr")
install_or_call <- function(list = packages_list){
installed <- installed.packages()[,"Package"]
for( package in packages_list ){
if(!(package %in% installed)){
install.packages(package)
}
do.call(library, list(package))
}
}
install_or_call()
data("f_data_sm")
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
cl_po_teams <- tables$TEAM
elo_ratings_1 <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$elos
unique(elo_ratings_1$team)
missing_teams <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$missing_teams
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]|\\."
teams <- trimws(sapply(missing_teams$TEAM, str_remove_all, pattern = pattern))
missing_teams$TEAM <- teams
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]|\\."
teams <- trimws(sapply(missing_teams$TEAM, str_remove_all, pattern = pattern))
missing_teams$TEAM <- teams
View(missing_teams)
View(missing_teams)
View(missing_teams_2)
View(missing_teams_2)
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]|\\."
teams <- trimws(sapply(missing_teams$TEAM, str_remove_all, pattern = pattern))
missing_teams$TEAM <- teams
View(missing_teams)
View(missing_teams)
missing_teams$TEAM <- teams
View(missing_teams)
View(missing_teams)
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
tables <- standings(data = all_games)
cl_po_teams <- tables$TEAM
elo_ratings_1 <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$elos
missing_teams <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$missing_teams
unique(elo_ratings_1$team)
elo_matched_1 <- data.frame(TEAM = unique(elo_ratings_1$team), ELO.TEAM = unique(elo_ratings_1$team))
View(elo_matched_1)
View(elo_matched_1)
missing_teams <- cleaning_elos(data = elo_ratings, subset = cl_po_teams)$missing_teams
View(missing_teams)
View(missing_teams)
pattern = "AFC|ACF|FC|CF|SSC|AJ|KAA|VfL|SL|AC|AS|[0-9]|\\."
teams <- trimws(sapply(missing_teams$TEAM, str_remove_all, pattern = pattern))
missing_teams$ELO.TEAM <- teams
elo_ratings_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$ELO.TEAM)$elos
missing_teams_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$ELO.TEAM)$missing_teams
View(missing_teams_2)
View(missing_teams_2)
View(elo_ratings)
View(elo_ratings)
missing_teams_3 %>%
anti_join(missing_teams_2, by = TEAM)
missing_teams_3 <- missing_teams %>%
anti_join(missing_teams_2, by = TEAM)
missing_teams_3 <- missing_teams %>%
anti_join(missing_teams_2, by = c("TEAM"))
View(missing_teams_3)
View(missing_teams_3)
elo_ratings_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$ELO.TEAM)$elos
missing_teams_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$ELO.TEAM)$missing_teams
View(missing_teams_2)
View(missing_teams_2)
View(missing_teams_3)
View(missing_teams_3)
View(elo_ratings_2)
View(elo_ratings_2)
missing_teams$ELO.TEAM <- teams
elo_ratings_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$ELO.TEAM)$elos
missing_teams_2 <- cleaning_elos(data = elo_ratings, subset = missing_teams$ELO.TEAM)$missing_teams
View(missing_teams_3)
View(missing_teams_3)
View(missing_teams_2)
View(missing_teams_2)
View(missing_teams_2)
View(missing_teams_2)
View(missing_teams)
View(missing_teams)
missing_teams %>%
anti_join(missing_teams_2, by = c("TEAM"))
missing_teams_2$ELO.TEAM <- missing_teams_2$TEAM
missing_teams %>%
anti_join(missing_teams_2)
missing_teams_3 <- missing_teams %>%
anti_join(missing_teams_2)
View(missing_teams_3)
View(missing_teams_3)
missing_teams$ELO.TEAM <- teams
unique(elo_ratings_2$team)
View(missing_teams)
View(missing_teams)
missing_teams_3 <- missing_teams %>%
filter(!(ELO.TEAM %in% unique(elo_ratings_2$team)))
missing_teams_3 <- missing_teams %>%
filter(!(ELO.TEAM %in% unique(elo_ratings_2$team)))
View(missing_teams_3)
View(missing_teams_3)
View(elo_ratings)
View(elo_ratings)
missing_teams_3$ELO.TEAM <- c("PSG","Internazionale","Olympique Lyonnais",
"Schalke 04","Bordeaux","PSV", "Zenit",
"Olympiakos Piraeus", "APOEL", "Lazio", "Stuttgart")
missing_teams_3[-c(1),]
missing_teams_3 <- missing_teams_3[-c(5,7,9,14,15,16,17,18,20,21),]
missing_teams_3$ELO.TEAM <- c("PSG","Internazionale","Olympique Lyonnais",
"Schalke 04","Bordeaux","PSV", "Zenit",
"Olympiakos Piraeus", "APOEL", "Lazio", "Stuttgart")
elo_ratings_3 <- cleaning_elos(data = elo_ratings, subset = missing_teams_3$ELO.TEAM)$elos
missing_teams_4 <- cleaning_elos(data = elo_ratings, subset = missing_teams_3$ELO.TEAM)$missing_teams
save(tables, file = "data/po_table.rda")
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
source('~/workspace/SportsAnalytics/ET_Analysis/analysis.R', echo=TRUE)
load("data/po_elos.rda")
save(po_elos, "../data/po_elos.rda")
