dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- convert_to_date(date_string)
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date_string <- df_clean[index+1,]$AWAYTEAM
date <- convert_to_date(date_string)
}
dates <- c(dates, date)
}
print(dates)
return(dates)
}
dates <- game_dates(df_clean)
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- convert_to_date(date_string)
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date_string <- df_clean[index+1,]$HOMETEAM
date <- convert_to_date(date_string)
}
dates <- c(dates, date)
}
print(dates)
return(dates)
}
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- convert_to_date(date_string)
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date_string <- df_clean[index+1,]$AWAYTEAM
date <- convert_to_date(date_string)
}
dates <- c(dates, date)
}
return(dates)
}
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- convert_to_date(date_string)
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date_string <- df_clean[index+1,]$AWAYTEAM
date <- convert_to_date(date_string)
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
dates <- game_dates(df_clean)
dates
convert_to_date <- function(string){
pattern1 <- ".*(\\d{1,2}/\\d{1,2}/\\d{4}).*"
pattern2 <- "\\1"
format <- "%m/%d/%Y"
return (as.Date( gsub(pattern1,pattern2,string) ,
format=format))
}
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- convert_to_date(date_string)
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date_string <- df_clean[index+1,]$AWAYTEAM
date <- convert_to_date(date_string)
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
dates <- game_dates(df_clean)
dates_fixed <- as.Date(dates, format="%m/%d/%Y")
dates_fixed <- as.Date(dates[0], format="%m/%d/%Y")
dates[0]
dates_fixed <- as.Date(dates[1], format="%m/%d/%Y")
dates[1]
as.Date(17258, format = "%m/%d/%Y")
as.Date(17258, format = "%m/%d/%Y", origin="1970-01-01")
as.Date(17258, format = "%m/%d/%Y", origin="1970-01-01")
as.Date(17528, origin = "1970-01-01")
as.Date(17258, origin = "1970-01-01")
library(stringr)
string <- "14/02/2017 19:45"
str_extract(string, "(?<=[(])[^)]+")
sub("^[^(]+\\(([^)]+).*", "\\1", string)
sub("^[^(]+\\(([^)]+).*", "\\1", string)
dates <- game_dates(df_clean)
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- df_clean[index+2,]$HOMETEAM
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date <- df_clean[index+1,]$AWAYTEAM
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
dates <- game_dates(df_clean)
dates_fixed <- as.Date(dates[1], format="%m/%d/%Y")
dates <- game_dates(df_clean)
dates
df_clean <- df_clean[!apply(df_clean == "", 1, all),]
View(df_clean)
View(df_clean)
View(df)
View(df)
View(df_clean)
View(df_clean)
df_clean[3,2] == ""
df_clean <- df_clean %>%
filter(!(LEG == ""))
View(df_clean)
View(df_clean)
dates <- dates[!is.na(dates)]
df_clean$DATE <- dates
df_clean <- data.frame(COMP = UCL, SEASON = 2017, LEG = df$X1, HOMETEAM = df$X2, AWAYTEAM = df$X4,
RESULT = df$X5, stringsAsFactors = F )
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- df_clean[index+2,]$HOMETEAM
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date <- df_clean[index+1,]$AWAYTEAM
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
dates <- game_dates(df_clean)
df_clean <- df_clean %>%
filter(!(LEG == ""))
dates <- dates[!is.na(dates)]
df_clean$DATE <- dates
df_clean <- data.frame(COMP = "UCL", SEASON = 2017, LEG = df$X1, HOMETEAM = df$X2, AWAYTEAM = df$X4,
RESULT = df$X5, stringsAsFactors = F )
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,2] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- df_clean[index+2,]$HOMETEAM
}
else if(df_clean[index,2] == "2nd (2nd leg)"){
date <- df_clean[index+1,]$AWAYTEAM
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
dates <- game_dates(df_clean)
df_clean <- df_clean %>%
filter(!(LEG == ""))
dates <- dates[!is.na(dates)]
df_clean$DATE <- dates
dates <- dates[!is.na(dates)]
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,3] == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- df_clean[index+2,]$HOMETEAM
}
else if(df_clean[index,3] == "2nd (2nd leg)"){
date <- df_clean[index+1,]$AWAYTEAM
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
dates <- game_dates(df_clean)
df_clean <- df_clean %>%
filter(!(LEG == ""))
dates <- dates[!is.na(dates)]
df_clean$DATE <- dates
dates <- game_dates(df_clean)
source('~/Desktop/AwayGoalRule/scraping/scrapGames.R', echo=TRUE)
View(df)
View(df)
source('~/Desktop/AwayGoalRule/scraping/scrapGames.R', echo=TRUE)
View(df_clean)
View(df_clean)
clean_data <- function(data) {
df_clean <- data.frame(COMP = "UCL", SEASON = 2017,
LEG = data$X1, HOMETEAM = data$X2,
AWAYTEAM = data$X4,
RESULT = data$X5, stringsAsFactors = F )
dates <- game_dates(df_clean)
df_clean <- df_clean %>%
filter(!(LEG == ""))
dates <- dates[!is.na(dates)]
df_clean$DATE <- dates
return(df_clean)
}
paste(2018, 2017, sep = "-")
get_seasons <- function(start, end){
seasons <- c()
for(year in start:end){
season <- paste(year, year+1, sep = "-")
}
}
seasons1 <- get_seasons(2007, 2018)
get_seasons <- function(start, end){
seasons <- c()
for(year in start:end){
season <- paste(year, year+1, sep = "-")
seasons <- c(seasons, season)
}
return(seasons)
}
seasons1 <- get_seasons(2007, 2018)
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,]$LEG == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- df_clean[index+2,]$HOMETEAM
}
else if(df_clean[index,]$LEG == "2nd (2nd leg)"){
date <- df_clean[index+1,]$AWAYTEAM
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
seasons1 <- get_seasons(2007, 2018)
seasons2 <- get_seasons(1992, 2006)
library(rvest)
library(curl)
library(dplyr)
library(magrittr)
library(stringr)
get_seasons <- function(start, end){
seasons <- c()
for(year in start:end){
season <- paste(year, year+1, sep = "-")
seasons <- c(seasons, season)
}
return(seasons)
}
games_url <- "https://www.worldfootball.net/schedule/champions-league-2011-2012-achtelfinale/0/"
ucl_games <- "https://www.worldfootball.net/schedule/champions-league-"
seasons1 <- get_seasons(2007, 2018)
seasons2 <- get_seasons(1992, 2006)
rounds <- list(R16 = "achtelfinale",
R8 = "viertelfinale",
R4 = "halbfinale",
RF = "finale",
RF1 = "endspiel")
game_dates <- function(df_clean){
dates <- c()
for(index in 1:nrow(df_clean)){
if(df_clean[index,]$LEG == "1st(1st leg)"){
date_string <- df_clean[index+2,]$HOMETEAM
date <- df_clean[index+2,]$HOMETEAM
}
else if(df_clean[index,]$LEG == "2nd (2nd leg)"){
date <- df_clean[index+1,]$AWAYTEAM
}
else{
date <- NA
}
dates <- c(dates, date)
}
return(dates)
}
clean_data <- function(data, round) {
df_clean <- data.frame(COMP = "UCL", SEASON = 2017,
LEG = data$X1, HOMETEAM = data$X2,
AWAYTEAM = data$X4,
RESULT = data$X5, stringsAsFactors = F )
dates <- game_dates(df_clean)
df_clean <- df_clean %>%
filter(!(LEG == ""))
dates <- dates[!is.na(dates)]
df_clean$DATE <- dates
return(df_clean)
}
table <- read_html(games_url) %>%
html_node(css = ".standard_tabelle") %>%
html_table(header = FALSE)
df <- as.data.frame(table)
View(df)
View(df)
clean_df <- clean_data(df, round = "R16")
View(clean_df)
View(clean_df)
source('~/Desktop/AwayGoalRule/scraping/scrapGames.R', echo=TRUE)
View(clean_df)
View(clean_df)
rounds$R16
ucl_data <- function(){
for(season in seasons1){
url_16 <- paste(games_url, season, "-", rounds$R16)
url_8 <- paste(games_url, season, "-", rounds$R8)
url_4 <- paste(games_url, season, "-", rounds$R4)
url_f <- paste(games_url, season, "-", rounds$RF)
urls <- c(url_16,url_8,url_4,url_f)
}
return(urls)
}
urls <- ucl_data()
urls[5]
urls[[4]]
ucl_data <- function(){
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16)
url_8 <- paste(ucl_games, season, "-", rounds$R8)
url_4 <- paste(ucl_games, season, "-", rounds$R4)
url_f <- paste(ucl_games, season, "-", rounds$RF)
urls <- c(url_16,url_8,url_4,url_f)
}
return(urls)
}
urls <- ucl_data()
urls[[4]]
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16, sep = "")
url_8 <- paste(ucl_games, season, "-", rounds$R8, sep = "")
url_4 <- paste(ucl_games, season, "-", rounds$R4, sep = "")
url_f <- paste(ucl_games, season, "-", rounds$RF, sep = "")
urls <- c(url_16,url_8,url_4,url_f)
}
return(urls)
ucl_data <- function(){
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16, sep = "")
url_8 <- paste(ucl_games, season, "-", rounds$R8, sep = "")
url_4 <- paste(ucl_games, season, "-", rounds$R4, sep = "")
url_f <- paste(ucl_games, season, "-", rounds$RF, sep = "")
urls <- c(url_16,url_8,url_4,url_f)
}
return(urls)
}
urls <- ucl_data()
urls[[4]]
ucl_data <- function(){
urls <- c()
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16, sep = "")
url_8 <- paste(ucl_games, season, "-", rounds$R8, sep = "")
url_4 <- paste(ucl_games, season, "-", rounds$R4, sep = "")
url_f <- paste(ucl_games, season, "-", rounds$RF, sep = "")
urls <- c(url_16,url_8,url_4,url_f)
}
return(urls)
}
urls <- ucl_data()
ucl_data <- function(){
urls <- c()
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16, sep = "")
url_8 <- paste(ucl_games, season, "-", rounds$R8, sep = "")
url_4 <- paste(ucl_games, season, "-", rounds$R4, sep = "")
url_f <- paste(ucl_games, season, "-", rounds$RF, sep = "")
urls <- c(url_16,url_8,url_4,url_f)
}
return(urls)
}
ucl_data <- function(){
urls <- c()
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16, sep = "")
url_8 <- paste(ucl_games, season, "-", rounds$R8, sep = "")
url_4 <- paste(ucl_games, season, "-", rounds$R4, sep = "")
url_f <- paste(ucl_games, season, "-", rounds$RF, sep = "")
urls <- c(urls,url_16,url_8,url_4,url_f)
}
return(urls)
}
urls <- ucl_data()
get_df <- function(url){
table <- read_html(url) %>%
html_node(css = ".standard_tabelle") %>%
html_table(header = FALSE)
return(as.data.frame(table))
}
get_df <- function(url){
table <- read_html(url) %>%
html_node(css = ".standard_tabelle") %>%
html_table(header = FALSE)
return(as.data.frame(table))
}
ucl_data <- function(){
result <- c()
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16, sep = "")
url_8 <- paste(ucl_games, season, "-", rounds$R8, sep = "")
url_4 <- paste(ucl_games, season, "-", rounds$R4, sep = "")
url_f <- paste(ucl_games, season, "-", rounds$RF, sep = "")
r16 <- get_df(url_16)
data_16 <- clean_data(r16,round = rounds$R16)
r8 <- get_df(url_8)
data_8 <- clean_data(r8,round = rounds$R8)
r4 <- get_df(url_4)
data_4 <- clean_data(r16,round = rounds$R4)
rf <- get_df(url_f)
data_f <- clean_data(rf,round = rounds$RF)
result <- rbind(result, data_16, data_8, data_4, data_f)
}
return(result)
}
data <- ucl_data()
ucl_data <- function(){
result <- c()
for(season in seasons1){
url_16 <- paste(ucl_games, season, "-", rounds$R16, sep = "")
url_8 <- paste(ucl_games, season, "-", rounds$R8, sep = "")
url_4 <- paste(ucl_games, season, "-", rounds$R4, sep = "")
url_f <- paste(ucl_games, season, "-", rounds$RF, sep = "")
r16 <- get_df(url_16)
data_16 <- clean_data(r16,round = rounds$R16)
# r8 <- get_df(url_8)
# data_8 <- clean_data(r8,round = rounds$R8)
# r4 <- get_df(url_4)
# data_4 <- clean_data(r16,round = rounds$R4)
# rf <- get_df(url_f)
# data_f <- clean_data(rf,round = rounds$RF)
result <- rbind(result, data_16)
}
return(result)
}
data <- ucl_data()
View(data)
View(data)
clean_data <- function(data, season, round) {
df_clean <- data.frame(COMP = "UCL", SEASON = season, ROUND = round,
LEG = data$X1, HOMETEAM = data$X2,
AWAYTEAM = data$X4,
RESULT = data$X5, stringsAsFactors = F )
dates <- game_dates(df_clean)
df_clean <- df_clean %>%
filter(!(LEG == ""))
dates <- dates[!is.na(dates)]
df_clean$DATE <- dates
return(df_clean)
}
source('~/Desktop/AwayGoalRule/scraping/scrapGames.R', echo=TRUE)
View(data)
View(data)
save(data, file = "ucl_r16_2007_2018.rda")
games <- load("ucl_r16_2007_2018.rda")
games <- load(file = "ucl_r16_2007_2018.rda")
saveRDS(data, file = "ucl_r16.rds")
my_data <- readRDS("ucl_r16.rds")
View(my_data)
View(my_data)
save(data,file="data.Rda")
load("data.Rda")
aa <- load("data.Rda")
class(data)
saveRDS(data, file = "ucl_r16_2007_2018.rds")
saveRDS(data, file = "ucl_r16_2008_2019.rds")
data <- readRDS("ucl_r16_2008_2019.rds")
View(data)
View(data)
load("data/ucl_po_2008_2019.rda")
View(ucl_po_2008_2019_scrapped)
View(ucl_po_2008_2019_scrapped)
View(ucl_po_2008_2019_scrapped)
View(ucl_po_2008_2019_scrapped)
load("data/ucl_po_1994_2019.rda")
source('~/Desktop/AwayGoalRule/cleanData.R', echo=TRUE)
data <- read.csv("data/ucl_po_1994_2019.csv")
View(data)
View(data)
load("data/ucl_po_1994_2019.rda")
View(ucl_po_1994_2019_scrapped)
View(ucl_po_1994_2019_scrapped)
